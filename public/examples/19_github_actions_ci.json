{
  "id": "19_github_actions_ci",
  "title": "GitHub Actions Integration (CI/CD)",
  "tier": 4,
  "category": "Real-World",
  "description": "GitHub Actions Integration (CI/CD)",
  "estimatedTimeMinutes": 5,
  "minAudience": "developers",
  "isFeatured": false,
  "difficulty": "advanced",
  "tags": [
    "composition"
  ],
  "githubUrl": "https://github.com/microsoft/amplifier-foundation/blob/main/examples/19_github_actions_ci.py",
  "content": {
    "everyone": {
      "title": "GitHub Actions Integration (CI/CD)",
      "valueProposition": "Learn to work with AI agents",
      "howItWorks": [
        "Set up your AI environment",
        "Configure the agent with the right capabilities",
        "Run the example and see results",
        "Understand what happened"
      ],
      "whatYouGet": [
        "Working example you can run",
        "Clear understanding of the concept",
        "Foundation for building more"
      ]
    },
    "developers": {
      "title": "19_github_actions_ci.py - GitHub Actions Integration (CI/CD)",
      "valueProposition": "",
      "howItWorks": "",
      "keyConcepts": [
        "Amplifier bundle system",
        "Module composition",
        "Session execution"
      ],
      "codeOverview": {
        "structure": [
          "Load foundation and provider bundles",
          "Execute prompts and get responses"
        ],
        "keyFunctions": [
          {
            "name": "load_bundle",
            "description": "Loads a bundle from path or URL",
            "usage": "load_bundle(str(foundation_path)"
          },
          {
            "name": "execute",
            "description": "Executes a prompt",
            "usage": "execute(prompt)"
          },
          {
            "name": "mount",
            "description": "Registers a custom tool or component",
            "usage": "mount(...)"
          }
        ]
      },
      "codeSnippet": "async def main():\n    \"\"\"Run interactive demo menu.\"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udd04 GitHub Actions Integration (CI/CD)\")\n    print(\"=\" * 80)\n    print(\"\\nVALUE: Integrate AI-powered automation into your CI/CD pipeline\")\n    print(\"AUDIENCE: DevOps engineers, development teams\")\n    print(\"\\nWhat this demonstrates:\")\n    print(\"  - Automated code review on PRs\")\n    print(\"  - Test failure analysis\")\n    print(\"  - Release note generation\")\n    print(\"  - Security scanning\")\n\n    workflows = [\n        (\"Code Review (PR analysis)\", workflow_code_review),"
    },
    "experts": {
      "title": "19_github_actions_ci.py - GitHub Actions Integration (CI/CD)",
      "complexity": "Tier 4 - Real-World Applications",
      "sourceUrl": "https://github.com/microsoft/amplifier-foundation/blob/main/examples/19_github_actions_ci.py",
      "architecture": "",
      "fullCode": "#!/usr/bin/env python3\n\"\"\"\nExample 19: GitHub Actions Integration (CI/CD)\n===============================================\n\nAUDIENCE: DevOps engineers, teams implementing AI-powered CI/CD\nVALUE: Shows how to integrate Amplifier into automated workflows\nPATTERN: CI/CD automation, code review bots, PR analysis\n\nWhat this demonstrates:\n  - Running Amplifier in GitHub Actions workflows\n  - Automated code review and analysis\n  - PR comment generation\n  - Test failure analysis\n  - Release note generation\n\nWhen you'd use this:\n  - Automated code review on PRs\n  - Security scanning with AI insights\n  - Test failure root cause analysis\n  - Automated documentation generation\n  - Release management automation\n\"\"\"\n\nimport asyncio\nimport os\nfrom pathlib import Path\nfrom typing import Any\n\nfrom amplifier_core import AmplifierSession\nfrom amplifier_foundation import load_bundle\n\n# ============================================================================\n# GitHub Actions Helpers\n# ============================================================================\n\n\ndef is_github_actions() -> bool:\n    \"\"\"Check if running in GitHub Actions environment.\"\"\"\n    return os.getenv(\"GITHUB_ACTIONS\") == \"true\"\n\n\ndef get_github_context() -> dict[str, Any]:\n    \"\"\"Get GitHub Actions context information.\"\"\"\n    return {\n        \"repository\": os.getenv(\"GITHUB_REPOSITORY\", \"unknown/unknown\"),\n        \"ref\": os.getenv(\"GITHUB_REF\", \"unknown\"),\n        \"sha\": os.getenv(\"GITHUB_SHA\", \"unknown\"),\n        \"actor\": os.getenv(\"GITHUB_ACTOR\", \"unknown\"),\n        \"workflow\": os.getenv(\"GITHUB_WORKFLOW\", \"unknown\"),\n        \"run_id\": os.getenv(\"GITHUB_RUN_ID\", \"unknown\"),\n        \"event_name\": os.getenv(\"GITHUB_EVENT_NAME\", \"unknown\"),\n    }\n\n\ndef set_output(name: str, value: str):\n    \"\"\"Set GitHub Actions output variable.\"\"\"\n    if is_github_actions():\n        print(f\"::set-output name={name}::{value}\")\n    else:\n        print(f\"OUTPUT: {name}={value}\")\n\n\ndef post_pr_comment(comment: str):\n    \"\"\"\n    Post comment to PR (simulated).\n\n    In real implementation, use GitHub API or gh CLI.\n    \"\"\"\n    if is_github_actions():\n        # Write to file that workflow can pick up\n        with open(\"pr_comment.txt\", \"w\") as f:\n            f.write(comment)\n        print(\"::notice::PR comment written to pr_comment.txt\")\n    else:\n        print(\"\\n\" + \"=\" * 80)\n        print(\"\ud83d\udcdd PR COMMENT\")\n        print(\"=\" * 80)\n        print(comment)\n\n\ndef fail_if_critical_issues(issues: list[dict[str, Any]]):\n    \"\"\"Fail the workflow if critical issues found.\"\"\"\n    critical = [i for i in issues if i.get(\"severity\") == \"critical\"]\n    if critical:\n        print(f\"::error::Found {len(critical)} critical issues\")\n        if not is_github_actions():\n            print(\"\\n\u274c CRITICAL ISSUES FOUND - workflow would fail\")\n\n\n# ============================================================================\n# CI/CD Workflows\n# ============================================================================\n\n\nasync def workflow_code_review():\n    \"\"\"\n    Workflow: Automated code review on PR.\n\n    Analyzes changed files and provides feedback.\n    \"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udd0d WORKFLOW: Automated Code Review\")\n    print(\"=\" * 80)\n\n    # Get GitHub context\n    context = get_github_context()\n    print(f\"\\nRepository: {context['repository']}\")\n    print(f\"Event: {context['event_name']}\")\n    print(f\"SHA: {context['sha'][:8]}\")\n\n    # Simulate getting PR diff\n    pr_files = [\n        \"src/api/users.py\",\n        \"src/api/auth.py\",\n        \"tests/test_users.py\",\n    ]\n\n    print(f\"\\nFiles changed: {len(pr_files)}\")\n    for f in pr_files:\n        print(f\"  - {f}\")\n\n    # Load Amplifier\n    foundation_path = Path(__file__).parent.parent\n    foundation = await load_bundle(str(foundation_path))\n    mount_plan = foundation.to_mount_plan()\n\n    session = AmplifierSession(config=mount_plan)\n    await session.initialize()\n\n    # Generate code review\n    prompt = f\"\"\"Perform a code review on the following changed files:\n\nFiles: {\", \".join(pr_files)}\n\nPlease review for:\n1. Security vulnerabilities\n2. Code quality and best practices\n3. Test coverage\n4. Performance issues\n5. Documentation completeness\n\nProvide feedback in this format:\n- File: [filename]\n- Issue: [description]\n- Severity: [critical/high/medium/low]\n- Suggestion: [how to fix]\n\nBe concise but thorough.\"\"\"\n\n    print(\"\\n\u23f3 Generating code review...\")\n\n    try:\n        review = await session.execute(prompt)\n\n        # Post as PR comment\n        comment = f\"\"\"## \ud83e\udd16 AI Code Review\n\n{review}\n\n---\n*Generated by Amplifier in CI/CD workflow*\n*Commit: {context[\"sha\"][:8]}*\n\"\"\"\n        post_pr_comment(comment)\n\n        # Set outputs for workflow\n        set_output(\"review_completed\", \"true\")\n        set_output(\"review_length\", str(len(review)))\n\n        print(\"\\n\u2705 Code review completed\")\n\n    finally:\n        await session.cleanup()\n\n\nasync def workflow_test_failure_analysis():\n    \"\"\"\n    Workflow: Analyze test failures and provide insights.\n\n    Helps developers understand why tests failed.\n    \"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83e\uddea WORKFLOW: Test Failure Analysis\")\n    print(\"=\" * 80)\n\n    # Simulate test failure output\n    test_failure = \"\"\"\n    FAILED tests/test_users.py::test_create_user - AssertionError:\n    Expected user.email to be 'test@example.com' but got None\n\n    Traceback:\n      File \"tests/test_users.py\", line 45, in test_create_user\n        assert user.email == 'test@example.com'\n    \"\"\"\n\n    print(\"\\nTest failure detected:\")\n    print(test_failure)\n\n    # Load Amplifier\n    foundation_path = Path(__file__).parent.parent\n    foundation = await load_bundle(str(foundation_path))\n    mount_plan = foundation.to_mount_plan()\n\n    session = AmplifierSession(config=mount_plan)\n    await session.initialize()\n\n    prompt = f\"\"\"Analyze this test failure and provide insights:\n\n{test_failure}\n\nPlease provide:\n1. Root cause analysis\n2. Likely code issues that could cause this\n3. Suggested fixes\n4. Related tests that might also fail\n\nBe specific and actionable.\"\"\"\n\n    print(\"\\n\u23f3 Analyzing test failure...\")\n\n    try:\n        analysis = await session.execute(prompt)\n\n        # Post as workflow annotation\n        comment = f\"\"\"## \ud83d\udd2c Test Failure Analysis\n\n{analysis}\n\n---\n*AI-powered analysis by Amplifier*\n\"\"\"\n        post_pr_comment(comment)\n\n        print(\"\\n\u2705 Analysis completed\")\n\n    finally:\n        await session.cleanup()\n\n\nasync def workflow_release_notes():\n    \"\"\"\n    Workflow: Generate release notes from commits.\n\n    Creates human-readable release notes from git history.\n    \"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udccb WORKFLOW: Release Notes Generation\")\n    print(\"=\" * 80)\n\n    # Simulate commit messages\n    commits = [\n        \"feat: Add user authentication with JWT\",\n        \"fix: Resolve memory leak in session manager\",\n        \"docs: Update API documentation\",\n        \"perf: Optimize database queries for user lookup\",\n        \"test: Add integration tests for auth flow\",\n    ]\n\n    print(f\"\\nCommits since last release: {len(commits)}\")\n    for commit in commits:\n        print(f\"  - {commit}\")\n\n    # Load Amplifier\n    foundation_path = Path(__file__).parent.parent\n    foundation = await load_bundle(str(foundation_path))\n    mount_plan = foundation.to_mount_plan()\n\n    session = AmplifierSession(config=mount_plan)\n    await session.initialize()\n\n    prompt = f\"\"\"Generate professional release notes from these commits:\n\n{chr(10).join(commits)}\n\nFormat as:\n## Features\n- [user-facing features]\n\n## Bug Fixes\n- [user-facing fixes]\n\n## Performance\n- [performance improvements]\n\n## Documentation\n- [doc updates]\n\nMake it clear, concise, and user-focused.\"\"\"\n\n    print(\"\\n\u23f3 Generating release notes...\")\n\n    try:\n        notes = await session.execute(prompt)\n\n        # Save to file for release\n        with open(\"RELEASE_NOTES.md\", \"w\") as f:\n            f.write(f\"# Release Notes\\n\\n{notes}\\n\")\n\n        print(\"\\n\u2705 Release notes generated\")\n        print(\"\\n\" + \"=\" * 80)\n        print(notes[:500] + \"...\" if len(notes) > 500 else notes)\n\n        set_output(\"release_notes_generated\", \"true\")\n\n    finally:\n        await session.cleanup()\n\n\nasync def workflow_security_scan():\n    \"\"\"\n    Workflow: AI-powered security scanning.\n\n    Analyzes code for security vulnerabilities with AI insights.\n    \"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udd12 WORKFLOW: Security Scanning\")\n    print(\"=\" * 80)\n\n    # Simulate code snippet\n    code_snippet = \"\"\"\ndef login(username, password):\n    query = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"\n    user = db.execute(query)\n    return user\n\"\"\"\n\n    print(\"\\nScanning code for security issues...\")\n    print(code_snippet)\n\n    # Load Amplifier\n    foundation_path = Path(__file__).parent.parent\n    foundation = await load_bundle(str(foundation_path))\n    mount_plan = foundation.to_mount_plan()\n\n    session = AmplifierSession(config=mount_plan)\n    await session.initialize()\n\n    prompt = f\"\"\"Perform a security audit of this code:\n\n{code_snippet}\n\nIdentify:\n1. Security vulnerabilities (SQL injection, XSS, etc.)\n2. Severity level (critical/high/medium/low)\n3. Exploit scenarios\n4. Recommended fixes with code examples\n\nBe thorough and specific.\"\"\"\n\n    print(\"\\n\u23f3 Running security scan...\")\n\n    try:\n        scan_results = await session.execute(prompt)\n\n        # Check for critical issues\n        issues = [{\"severity\": \"critical\", \"type\": \"SQL Injection\"}]  # Simulated\n\n        fail_if_critical_issues(issues)\n\n        # Post results\n        comment = f\"\"\"## \ud83d\udd12 Security Scan Results\n\n{scan_results}\n\n---\n*Automated security scan by Amplifier*\n\"\"\"\n        post_pr_comment(comment)\n\n        print(\"\\n\u2705 Security scan completed\")\n\n    finally:\n        await session.cleanup()\n\n\n# ============================================================================\n# GitHub Actions Workflow YAML Generator\n# ============================================================================\n\n\ndef generate_workflow_yaml():\n    \"\"\"Generate example GitHub Actions workflow YAML.\"\"\"\n    yaml_content = \"\"\"\nname: AI Code Review\n\non:\n  pull_request:\n    types: [opened, synchronize]\n\njobs:\n  ai-review:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: |\n          pip install amplifier-core amplifier-foundation\n\n      - name: Run AI code review\n        env:\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n        run: |\n          python examples/19_github_actions_ci.py --workflow=code-review\n\n      - name: Post PR comment\n        if: always()\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const fs = require('fs');\n            const comment = fs.readFileSync('pr_comment.txt', 'utf8');\n            github.rest.issues.createComment({\n              issue_number: context.issue.number,\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              body: comment\n            });\n\n  security-scan:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: |\n          pip install amplifier-core amplifier-foundation\n\n      - name: Run security scan\n        env:\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n        run: |\n          python examples/19_github_actions_ci.py --workflow=security-scan\n\"\"\"\n\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udcc4 EXAMPLE GITHUB ACTIONS WORKFLOW\")\n    print(\"=\" * 80)\n    print(\"\\nSave this as .github/workflows/ai-review.yml:\")\n    print(\"=\" * 80)\n    print(yaml_content)\n\n    # Save to file\n    output_file = \"github_actions_workflow.yml\"\n    with open(output_file, \"w\") as f:\n        f.write(yaml_content)\n\n    print(f\"\\n\ud83d\udcbe Workflow saved to: {output_file}\")\n\n\n# ============================================================================\n# Interactive Menu\n# ============================================================================\n\n\nasync def main():\n    \"\"\"Run interactive demo menu.\"\"\"\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udd04 GitHub Actions Integration (CI/CD)\")\n    print(\"=\" * 80)\n    print(\"\\nVALUE: Integrate AI-powered automation into your CI/CD pipeline\")\n    print(\"AUDIENCE: DevOps engineers, development teams\")\n    print(\"\\nWhat this demonstrates:\")\n    print(\"  - Automated code review on PRs\")\n    print(\"  - Test failure analysis\")\n    print(\"  - Release note generation\")\n    print(\"  - Security scanning\")\n\n    workflows = [\n        (\"Code Review (PR analysis)\", workflow_code_review),\n        (\"Test Failure Analysis\", workflow_test_failure_analysis),\n        (\"Release Notes Generation\", workflow_release_notes),\n        (\"Security Scanning\", workflow_security_scan),\n    ]\n\n    print(\"\\n\" + \"=\" * 80)\n    print(\"Choose a workflow to simulate:\")\n    print(\"=\" * 80)\n    for i, (name, _) in enumerate(workflows, 1):\n        print(f\"  {i}. {name}\")\n    print(\"  5. Generate GitHub Actions YAML\")\n    print(\"  q. Quit\")\n    print(\"-\" * 80)\n\n    choice = input(\"\\nYour choice: \").strip().lower()\n\n    if choice == \"q\":\n        print(\"\\n\ud83d\udc4b Goodbye!\")\n        return\n\n    if choice == \"5\":\n        generate_workflow_yaml()\n        return\n\n    try:\n        idx = int(choice) - 1\n        if 0 <= idx < len(workflows):\n            _, workflow_func = workflows[idx]\n            await workflow_func()\n        else:\n            print(\"\\n\u274c Invalid choice\")\n    except ValueError:\n        print(\"\\n\u274c Invalid choice\")\n\n    print(\"\\n\" + \"=\" * 80)\n    print(\"\ud83d\udca1 KEY TAKEAWAYS\")\n    print(\"=\" * 80)\n    print(\"\"\"\n1. **Automated Intelligence**: AI-powered insights in your CI/CD pipeline\n2. **Developer Experience**: Faster feedback, better context for issues\n3. **Quality Gates**: AI helps maintain code quality automatically\n4. **Cost-Effective**: Run only when needed (PR events, test failures)\n\n**Implementation tips:**\n- Use caching to speed up CI runs\n- Set appropriate timeouts\n- Store API keys in GitHub Secrets\n- Use workflow outputs to chain jobs\n- Add conditional logic (run only on certain files)\n\n**Common CI/CD patterns:**\n- PR review: Run on pull_request events\n- Security scan: Run on main branch commits\n- Release notes: Run on tag creation\n- Test analysis: Run on test failures\n- Documentation: Run on docs/ changes\n\n**GitHub Actions workflow structure:**\n```yaml\nname: AI Workflow\non: [pull_request]\njobs:\n  ai-task:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Run AI task\n        env:\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n        run: python your_script.py\n```\n\"\"\")\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n",
      "advancedOptions": {
        "provider": [
          "anthropic-sonnet",
          "anthropic-opus",
          "openai-gpt4"
        ],
        "streaming": false,
        "hooks": []
      }
    }
  },
  "execution": {
    "requiresInput": true,
    "defaultPrompt": null,
    "estimatedDuration": "2-5 seconds",
    "prerequisites": [
      "ANTHROPIC_API_KEY environment variable"
    ]
  }
}