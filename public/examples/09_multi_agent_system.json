{
  "id": "09_multi_agent_system",
  "title": "Multi-Agent System - Coordinating Specialized Agents",
  "tier": 3,
  "category": "Building Applications",
  "description": "Build sophisticated systems by composing specialized agents.\nEach agent has different tools, models,",
  "estimatedTimeMinutes": 30,
  "minAudience": "developers",
  "isFeatured": false,
  "difficulty": "intermediate",
  "tags": [
    "tools",
    "composition",
    "multi-agent"
  ],
  "githubUrl": "https://github.com/microsoft/amplifier-foundation/blob/main/examples/09_multi_agent_system.py",
  "content": {
    "everyone": {
      "title": "Multi-Agent System - Coordinating Specialized Agents",
      "valueProposition": "Build sophisticated systems by composing specialized agents.\nEach agent has different tools, models, and expertise.\nAmplifier handles the orchestration, you focus on the architecture.",
      "howItWorks": [
        "Set up your AI environment",
        "Configure the agent with the right capabilities",
        "Run the example and see results",
        "Understand what happened"
      ],
      "whatYouGet": [
        "Working example you can run",
        "Clear understanding of the concept",
        "Foundation for building more"
      ]
    },
    "developers": {
      "title": "09_multi_agent_system.py - Multi-Agent System - Coordinating Specialized Agents",
      "valueProposition": "Build sophisticated systems by composing specialized agents.\nEach agent has different tools, models, and expertise.\nAmplifier handles the orchestration, you focus on the architecture.",
      "howItWorks": "- How to define specialized agents with different capabilities\n- Sequential workflows (agent1 \u2192 agent2 \u2192 agent3)\n- Parallel execution patterns\n- Real-world multi-agent architectures",
      "keyConcepts": [
        "How to define specialized agents with different capabilities",
        "Sequential workflows (agent1 \u2192 agent2 \u2192 agent3)",
        "Parallel execution patterns",
        "Real-world multi-agent architectures"
      ],
      "codeOverview": {
        "structure": [
          "Load foundation and provider bundles",
          "Compose bundles together",
          "Prepare modules (download if needed)",
          "Create AI session",
          "Execute prompts and get responses"
        ],
        "keyFunctions": [
          {
            "name": "load_bundle",
            "description": "Loads a bundle from path or URL",
            "usage": "load_bundle(str(foundation_path)"
          },
          {
            "name": "compose",
            "description": "Combines multiple bundles",
            "usage": "compose(provider)"
          },
          {
            "name": "prepare",
            "description": "Downloads and activates modules",
            "usage": "prepare()"
          },
          {
            "name": "create_session",
            "description": "Creates an AI session",
            "usage": "create_session()"
          },
          {
            "name": "execute",
            "description": "Executes a prompt",
            "usage": "execute(full_instruction)"
          }
        ]
      },
      "codeSnippet": "async def main():\n    \"\"\"Run multi-agent system demonstration.\"\"\"\n\n    print(\"\ud83e\udd1d Amplifier Multi-Agent Systems\")\n    print(\"=\" * 60)\n    print(\"\\nKEY CONCEPT: Specialized Agents Working Together\")\n    print(\"- Each agent has different expertise, tools, and instructions\")\n    print(\"- Agents communicate through structured workflows\")\n    print(\"- Complex tasks decomposed into agent responsibilities\")\n    print(\"\\nREAL-WORLD PATTERN:\")\n    print(\"This is how you build sophisticated AI systems in production.\")\n\n    # Check API key\n    if not os.getenv(\"ANTHROPIC_API_KEY\"):\n        print(\"\\n\u274c ERROR: Set ANTHROPIC_API_KEY environment variable\")"
    },
    "experts": {
      "title": "09_multi_agent_system.py - Multi-Agent System - Coordinating Specialized Agents",
      "complexity": "Tier 3 - Building Applications",
      "sourceUrl": "https://github.com/microsoft/amplifier-foundation/blob/main/examples/09_multi_agent_system.py",
      "architecture": "Build sophisticated systems by composing specialized agents.\nEach agent has different tools, models, and expertise.\nAmplifier handles the orchestration, you focus on the architecture.",
      "fullCode": "#!/usr/bin/env python3\n\"\"\"\nExample 5: Multi-Agent System - Coordinating Specialized Agents\n================================================================\n\nVALUE PROPOSITION:\nBuild sophisticated systems by composing specialized agents.\nEach agent has different tools, models, and expertise.\nAmplifier handles the orchestration, you focus on the architecture.\n\nWHAT YOU'LL LEARN:\n- How to define specialized agents with different capabilities\n- Sequential workflows (agent1 \u2192 agent2 \u2192 agent3)\n- Parallel execution patterns\n- Real-world multi-agent architectures\n\nREAL-WORLD USE CASES:\n- Software development: architect + implementer + reviewer + tester\n- Data analysis: collector + analyzer + visualizer\n- Content creation: researcher + writer + editor\n- Customer support: classifier + resolver + escalator\n\nThis is the advanced pattern that makes Amplifier powerful for complex systems.\n\nTIME TO VALUE: 30 minutes\n\"\"\"\n\nimport asyncio\nimport os\nfrom pathlib import Path\nfrom typing import Any\n\nfrom amplifier_foundation import Bundle\nfrom amplifier_foundation import load_bundle\n\n# =============================================================================\n# SECTION 1: Define Specialized Agents\n# =============================================================================\n\n\ndef create_architect_agent(provider: Bundle) -> Bundle:\n    \"\"\"The Architect: Designs system architecture and specifications.\n\n    Expertise: System design, architecture patterns, API design\n    Tools: Read files, web search (for documentation)\n    \"\"\"\n    return Bundle(\n        name=\"architect\",\n        version=\"1.0.0\",\n        tools=[\n            {\n                \"module\": \"tool-filesystem\",\n                \"source\": \"git+https://github.com/microsoft/amplifier-module-tool-filesystem@main\",\n            },\n        ],\n        instruction=\"\"\"You are a Software Architect expert.\n\nYour role:\n- Design system architectures and specifications\n- Break down complex problems into modules\n- Define clear interfaces and contracts\n- Consider scalability, maintainability, and best practices\n\nWhen given a task:\n1. Analyze the requirements\n2. Design the architecture (components, interfaces, data flow)\n3. Create a specification document\n4. Return clear instructions for implementation\n\nFocus on design, not implementation. Be thorough but concise.\"\"\",\n    ).compose(provider)\n\n\ndef create_implementer_agent(provider: Bundle) -> Bundle:\n    \"\"\"The Implementer: Writes code based on specifications.\n\n    Expertise: Code implementation, testing, debugging\n    Tools: Full filesystem access, bash execution\n    \"\"\"\n    return Bundle(\n        name=\"implementer\",\n        version=\"1.0.0\",\n        tools=[\n            {\n                \"module\": \"tool-filesystem\",\n                \"source\": \"git+https://github.com/microsoft/amplifier-module-tool-filesystem@main\",\n            },\n            {\"module\": \"tool-bash\", \"source\": \"git+https://github.com/microsoft/amplifier-module-tool-bash@main\"},\n        ],\n        instruction=\"\"\"You are a Software Implementation expert.\n\nYour role:\n- Implement code based on specifications\n- Write clean, tested, documented code\n- Follow the architecture and contracts provided\n- Run tests to verify correctness\n\nWhen given a specification:\n1. Understand the requirements\n2. Implement the code\n3. Write tests\n4. Verify it works\n5. Document the implementation\n\nFocus on clean, working code that matches the spec exactly.\"\"\",\n    ).compose(provider)\n\n\ndef create_reviewer_agent(provider: Bundle) -> Bundle:\n    \"\"\"The Reviewer: Reviews code for quality, security, and best practices.\n\n    Expertise: Code review, security, best practices\n    Tools: Read-only filesystem access\n    \"\"\"\n    return Bundle(\n        name=\"reviewer\",\n        version=\"1.0.0\",\n        tools=[\n            {\n                \"module\": \"tool-filesystem\",\n                \"source\": \"git+https://github.com/microsoft/amplifier-module-tool-filesystem@main\",\n            },\n        ],\n        instruction=\"\"\"You are a Code Review expert.\n\nYour role:\n- Review code for correctness, security, and best practices\n- Identify bugs, vulnerabilities, and improvement opportunities\n- Provide actionable feedback\n\nWhen reviewing code:\n1. Check correctness (does it match the spec?)\n2. Check security (any vulnerabilities?)\n3. Check quality (readable, maintainable?)\n4. Check tests (adequate coverage?)\n5. Provide specific, actionable feedback\n\nBe thorough but constructive. Focus on important issues.\"\"\",\n    ).compose(provider)\n\n\n# =============================================================================\n# SECTION 2: Multi-Agent Orchestrator\n# =============================================================================\n\n\nclass MultiAgentSystem:\n    \"\"\"Orchestrates multiple specialized agents to complete complex tasks.\"\"\"\n\n    def __init__(self, foundation: Bundle, provider: Bundle):\n        self.foundation = foundation\n        self.provider = provider\n\n    async def execute_workflow(self, task: str, workflow: list[tuple[str, str, Bundle]]) -> dict[str, Any]:\n        \"\"\"Execute a multi-agent workflow.\n\n        Args:\n            task: The overall task description\n            workflow: List of (agent_name, instruction, agent_bundle) tuples\n\n        Returns:\n            Dict with results from each agent\n        \"\"\"\n        results = {}\n        context = {\"task\": task}\n\n        for agent_name, instruction, agent_bundle in workflow:\n            print(f\"\\n{'=' * 60}\")\n            print(f\"\ud83e\udd16 Agent: {agent_name.upper()}\")\n            print(f\"{'=' * 60}\")\n            print(f\"Instruction: {instruction[:100]}...\")\n\n            # Compose foundation + agent\n            composed = self.foundation.compose(agent_bundle)\n\n            print(\"\u23f3 Preparing agent...\")\n            prepared = await composed.prepare()\n            session = await prepared.create_session()\n\n            # Add context from previous agents\n            context_str = self._format_context(context, results)\n            full_instruction = f\"{context_str}\\n\\n{instruction}\"\n\n            # Execute\n            print(\"\ud83d\udd04 Executing...\")\n            async with session:\n                response = await session.execute(full_instruction)\n                results[agent_name] = response\n                print(f\"\\n\u2713 {agent_name} completed\")\n                print(f\"Response length: {len(response)} chars\")\n\n        return results\n\n    def _format_context(self, context: dict[str, Any], previous_results: dict[str, str]) -> str:\n        \"\"\"Format context from previous agents for the current agent.\"\"\"\n        if not previous_results:\n            return f\"Task: {context['task']}\"\n\n        sections = [f\"Task: {context['task']}\", \"\\nPrevious work:\"]\n        for agent_name, result in previous_results.items():\n            sections.append(f\"\\n{agent_name.upper()} OUTPUT:\")\n            sections.append(result[:500] + \"...\" if len(result) > 500 else result)\n\n        return \"\\n\".join(sections)\n\n\n# =============================================================================\n# SECTION 3: Example Workflow\n# =============================================================================\n\n\nasync def workflow_build_feature():\n    \"\"\"Workflow: Design \u2192 Implement \u2192 Review a new feature.\"\"\"\n\n    print(\"\\n\" + \"=\" * 60)\n    print(\"WORKFLOW: Build a Feature (Design \u2192 Implement \u2192 Review)\")\n    print(\"=\" * 60)\n\n    # Load foundation and provider\n    foundation_path = Path(__file__).parent.parent  # examples/ -> amplifier-foundation/\n    foundation = await load_bundle(str(foundation_path))\n    provider = await load_bundle(str(foundation_path / \"providers\" / \"anthropic-sonnet.yaml\"))\n\n    # Create multi-agent system\n    system = MultiAgentSystem(foundation, provider)\n\n    # Create specialized agents\n    architect = create_architect_agent(provider)\n    implementer = create_implementer_agent(provider)\n    reviewer = create_reviewer_agent(provider)\n\n    # Define workflow\n    task = \"Create a Python module for rate limiting API requests\"\n\n    workflow = [\n        (\n            \"architect\",\n            \"\"\"Design a rate limiting module for API requests.\n\nRequirements:\n- Support different rate limit strategies (token bucket, sliding window)\n- Thread-safe for concurrent requests\n- Configurable limits per endpoint\n- Include usage tracking\n\nProvide:\n1. Module structure\n2. Class definitions and interfaces\n3. Key algorithms\n4. Example usage\"\"\",\n            architect,\n        ),\n        (\n            \"implementer\",\n            \"\"\"Implement the rate limiting module based on the architect's design.\n\nCreate:\n1. rate_limiter.py with all classes\n2. A simple test to verify it works\n3. Brief usage example\n\nKeep it simple and focused.\"\"\",\n            implementer,\n        ),\n        (\n            \"reviewer\",\n            \"\"\"Review the rate limiter implementation.\n\nCheck:\n1. Does it match the architecture?\n2. Are there any bugs or edge cases?\n3. Is it thread-safe?\n4. Is the code readable and maintainable?\n\nProvide specific feedback for improvement.\"\"\",\n            reviewer,\n        ),\n    ]\n\n    # Execute workflow\n    results = await system.execute_workflow(task, workflow)\n\n    # Display summary\n    print(\"\\n\" + \"=\" * 60)\n    print(\"WORKFLOW COMPLETE - SUMMARY\")\n    print(\"=\" * 60)\n    for agent_name, result in results.items():\n        print(f\"\\n{agent_name.upper()}:\")\n        print(f\"  Output: {len(result)} characters\")\n        print(f\"  Preview: {result[:150]}...\")\n\n    return results\n\n\n# =============================================================================\n# Main Demo\n# =============================================================================\n\n\nasync def main():\n    \"\"\"Run multi-agent system demonstration.\"\"\"\n\n    print(\"\ud83e\udd1d Amplifier Multi-Agent Systems\")\n    print(\"=\" * 60)\n    print(\"\\nKEY CONCEPT: Specialized Agents Working Together\")\n    print(\"- Each agent has different expertise, tools, and instructions\")\n    print(\"- Agents communicate through structured workflows\")\n    print(\"- Complex tasks decomposed into agent responsibilities\")\n    print(\"\\nREAL-WORLD PATTERN:\")\n    print(\"This is how you build sophisticated AI systems in production.\")\n\n    # Check API key\n    if not os.getenv(\"ANTHROPIC_API_KEY\"):\n        print(\"\\n\u274c ERROR: Set ANTHROPIC_API_KEY environment variable\")\n        print(\"\\nExample:\")\n        print(\"  export ANTHROPIC_API_KEY='your-key-here'\")\n        print(\"  python 05_multi_agent_system.py\")\n        return\n\n    # Run demonstration\n    await workflow_build_feature()\n\n    print(\"\\n\" + \"=\" * 60)\n    print(\"\ud83d\udcda WHAT YOU LEARNED:\")\n    print(\"=\" * 60)\n    print(\"1. Agent Specialization: Different agents for different expertise\")\n    print(\"2. Workflow Orchestration: Sequential handoffs between agents\")\n    print(\"3. Context Passing: Agents build on previous work\")\n    print(\"4. Composition: Each agent is foundation + provider + tools + instruction\")\n    print(\"\\n\u2705 You now understand how to build multi-agent architectures!\")\n    print(\"\\nNEXT STEPS:\")\n    print(\"- Define agents for your domain\")\n    print(\"- Create workflows that match your business processes\")\n    print(\"- Consider parallel execution for independent tasks\")\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n",
      "advancedOptions": {
        "provider": [
          "anthropic-sonnet",
          "anthropic-opus",
          "openai-gpt4"
        ],
        "streaming": false,
        "hooks": []
      }
    }
  },
  "execution": {
    "requiresInput": false,
    "defaultPrompt": null,
    "estimatedDuration": "2-5 seconds",
    "prerequisites": [
      "ANTHROPIC_API_KEY environment variable"
    ]
  }
}