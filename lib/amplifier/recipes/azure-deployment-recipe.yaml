recipe:
  name: azure-deployment-validation
  version: 1.0.0
  description: Multi-agent infrastructure deployment validation demonstrating Azure as infrastructure intelligence platform

steps:
  - id: architecture-validation
    name: Architecture & Design Validation
    agent: developer-bundle
    bundle: 03-developer-bundle.yaml
    prompt: |
      Review the Azure infrastructure code for {{deployment_name}}.
      
      Infrastructure Code:
      {{infrastructure_code}}
      
      Analyze:
      - Overall architecture and topology
      - Resource organization and grouping
      - Naming conventions and consistency
      - Tagging strategy (cost center, environment, owner)
      - Network design and segmentation
      - High availability and redundancy
      - Scalability provisions
      
      Validate against Azure Well-Architected Framework:
      - Cost optimization
      - Operational excellence
      - Performance efficiency
      - Reliability
      - Security
      
      Identify architectural strengths and improvement areas.

  - id: security-compliance
    name: Security & Compliance Review
    agent: code-reviewer-bundle
    bundle: 04-code-reviewer-bundle.yaml
    prompt: |
      Perform security and compliance review of the Azure deployment for {{deployment_name}}.
      
      Based on the architecture from the previous step, analyze:
      
      **Security Posture:**
      - Network security groups and firewall rules
      - Identity and access management (RBAC)
      - Encryption at rest and in transit
      - Key management and secrets handling
      - Private endpoints and service endpoints
      - Monitoring and logging configuration
      
      **Compliance Requirements:**
      - Data residency ({{compliance_framework}} requirements)
      - Regulatory compliance (e.g., PCI-DSS, HIPAA, SOC2)
      - Audit logging and retention
      - Backup and disaster recovery
      
      **Security Risks:**
      - Critical vulnerabilities (severity: Critical/High)
      - Configuration weaknesses
      - Missing security controls
      - Compliance gaps
      
      Provide prioritized remediation recommendations.

  - id: cost-optimization
    name: Cost Analysis & Optimization
    agent: cloud-cost-analyzer-bundle
    bundle: 07-cloud-cost-analyzer-bundle.yaml
    prompt: |
      Analyze cost structure and optimization opportunities for {{deployment_name}}.
      
      Review:
      - Resource SKU sizing and utilization
      - Reserved capacity opportunities
      - Spot instance candidates
      - Storage tier optimization
      - Network egress costs
      - Idle or underutilized resources
      
      Calculate:
      - Estimated monthly cost
      - Potential savings from right-sizing
      - Reserved instance ROI
      - Architectural optimization savings
      
      Provide:
      - Current cost breakdown by resource type
      - Top 5 cost optimization opportunities
      - Estimated savings (monthly and annual)
      - Implementation complexity for each recommendation
      - Prioritized action plan
      
      Balance cost optimization with performance and reliability requirements.

  - id: deployment-documentation
    name: Deployment Runbook & Documentation
    agent: documentation-bundle
    bundle: 02-documentation-bundle.yaml
    prompt: |
      Create comprehensive deployment documentation for {{deployment_name}}.
      
      Based on all previous analysis, generate:
      
      **Deployment Runbook:**
      - Pre-deployment checklist
      - Step-by-step deployment procedure
      - Validation steps
      - Rollback plan
      
      **Architecture Documentation:**
      - Infrastructure diagram description
      - Resource inventory
      - Network topology
      - Security controls implemented
      
      **Operational Guide:**
      - Monitoring and alerting setup
      - Backup and recovery procedures
      - Scaling guidelines
      - Troubleshooting common issues
      
      **Compliance Documentation:**
      - Security controls matrix
      - Compliance artifacts generated
      - Audit trail configuration
      - Required approvals obtained
      
      **Cost Management:**
      - Cost allocation and tagging
      - Budget alerts configuration
      - Optimization recommendations tracking
      
      Format as production-ready deployment documentation.
